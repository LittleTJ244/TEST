<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­1è‹±èª Unit 5-6 å®Œç’§ãƒã‚¹ã‚¿ãƒ¼DX (100å•åéŒ²)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", sans-serif;
            background-color: #f3f4f6;
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .fade-in { animation: fadeIn 0.4s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* è§£èª¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .explanation-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #4f46e5;
        }
        .rule-box {
            background-color: #eef2ff;
            border: 2px dashed #818cf8;
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .highlight-marker {
            background: linear-gradient(transparent 60%, #fef08a 60%);
            font-weight: bold;
            padding: 0 2px;
        }

        /* ãƒ¦ãƒ‹ãƒƒãƒˆé¸æŠãƒœã‚¿ãƒ³ */
        .unit-btn {
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }
        .unit-btn.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
            font-weight: bold;
            transform: scale(1.05);
        }

        /* ã‚¯ã‚¤ã‚ºã‚«ãƒ¼ãƒ‰ */
        .question-card { transition: all 0.3s ease; border: 1px solid #e5e7eb; }
        .question-card.answered { border-color: #cbd5e1; background-color: #f8fafc; }

        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ */
        .choice-btn { transition: all 0.2s; border: 2px solid #e5e7eb; }
        .choice-btn.selected { border-color: #4f46e5; background-color: #eef2ff; color: #4f46e5; font-weight: bold; }
        .choice-btn:active { transform: scale(0.98); }

        /* ä¸¦ã¹æ›¿ãˆãƒãƒƒãƒ— */
        .sort-chip { transition: all 0.2s; cursor: pointer; border-bottom-width: 4px; }
        .sort-chip:active { transform: scale(0.95); border-bottom-width: 0px; margin-top: 4px; }
        .sort-chip.used { opacity: 0.3; pointer-events: none; filter: grayscale(100%); }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .custom-input { -webkit-user-select: text; user-select: text; }
        .custom-input:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-gray-800 h-screen w-screen overflow-hidden flex flex-col bg-gray-50">

    <!-- Header -->
    <div class="bg-indigo-600 p-4 text-white flex justify-between items-center shadow-lg z-20 shrink-0">
        <h1 class="text-lg font-bold flex items-center gap-2">
            <button onclick="goHome()" class="hover:bg-indigo-700 p-2 rounded-lg transition flex items-center gap-1">
                <i class="fas fa-home"></i> <span class="text-sm">ãƒ›ãƒ¼ãƒ </span>
            </button>
            <span class="ml-2">è‹±èªãƒã‚¹ã‚¿ãƒ¼</span>
        </h1>
    </div>

    <!-- Main Content Area -->
    <div id="main-container" class="flex-grow overflow-y-auto relative p-4 pb-32">

        <!-- 1. Start Screen -->
        <div id="start-screen" class="flex flex-col items-center justify-center min-h-[80vh] space-y-6 max-w-md mx-auto fade-in">
            <div class="text-center mb-2">
                <div class="inline-block p-5 bg-white rounded-full text-indigo-600 text-5xl mb-4 shadow-md">
                    <i class="fas fa-book-open"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-1">100ç‚¹ã‚²ãƒƒãƒˆç‰¹è¨“</h2>
                <p class="text-gray-500 text-sm">Unitã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼ï¼ˆå…¨100å•åéŒ²ï¼‰</p>
            </div>

            <!-- Unit Selection -->
            <div class="w-full bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                <p class="text-xs text-gray-500 font-bold mb-3 text-center uppercase tracking-wider">å­¦ç¿’ã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é¸æŠ</p>
                <div class="flex gap-2">
                    <button onclick="selectUnit(5)" id="btn-unit-5" class="unit-btn flex-1 py-3 rounded-lg text-sm font-bold text-gray-600 bg-gray-50">Unit 5<br><span class="text-xs font-normal">å ´æ‰€ãƒ»æ™‚ãƒ»å‘½ä»¤</span></button>
                    <button onclick="selectUnit(6)" id="btn-unit-6" class="unit-btn flex-1 py-3 rounded-lg text-sm font-bold text-gray-600 bg-gray-50">Unit 6<br><span class="text-xs font-normal">3å˜ç¾ã®s</span></button>
                    <button onclick="selectUnit('all')" id="btn-unit-all" class="unit-btn flex-1 py-3 rounded-lg text-sm font-bold text-gray-600 bg-gray-50 active">ã¾ã¨ã‚<br><span class="text-xs font-normal">ç·åˆãƒ†ã‚¹ãƒˆ</span></button>
                </div>
            </div>

            <div class="w-full space-y-4">
                <!-- è§£èª¬ãƒœã‚¿ãƒ³ -->
                <button onclick="showExplanation()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-400 text-white p-5 rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center transform hover:-translate-y-1 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition duration-300"></div>
                    <div class="text-left flex-grow">
                        <div class="font-bold text-xl"><i class="fas fa-book-reader mr-2"></i>ã“ã“ã ã‘èª­ã‚€ï¼</div>
                        <div class="text-sm opacity-90 font-medium">é¸æŠä¸­ãƒ¦ãƒ‹ãƒƒãƒˆã®é‡è¦ãƒã‚¤ãƒ³ãƒˆè§£èª¬</div>
                    </div>
                    <i class="fas fa-arrow-right text-white text-2xl animate-pulse"></i>
                </button>

                <div class="h-px bg-gray-300 w-full my-2"></div>

                <button onclick="startQuiz('vocab')" class="w-full bg-white border-l-8 border-green-500 p-4 rounded-xl shadow-sm hover:shadow-md transition flex items-center justify-between group">
                    <div class="text-left">
                        <div class="font-bold text-lg text-gray-800 group-hover:text-green-600 transition">å˜èªãƒ»ç†Ÿèª</div>
                        <div class="text-xs text-gray-500">åŸºæœ¬å˜èªã‚’ä¸€æ°—ã«ãƒã‚§ãƒƒã‚¯</div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 group-hover:text-green-500 transition"></i>
                </button>

                <button onclick="startQuiz('grammar')" class="w-full bg-white border-l-8 border-blue-500 p-4 rounded-xl shadow-sm hover:shadow-md transition flex items-center justify-between group">
                    <div class="text-left">
                        <div class="font-bold text-lg text-gray-800 group-hover:text-blue-600 transition">æ–‡æ³•ãƒ»ç©´åŸ‹ã‚</div>
                        <div class="text-xs text-gray-500">é¸æŠå¼ã§æ–‡æ³•ã‚’ç¢ºèª</div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 group-hover:text-blue-500 transition"></i>
                </button>

                <button onclick="startQuiz('text')" class="w-full bg-white border-l-8 border-red-500 p-4 rounded-xl shadow-sm hover:shadow-md transition flex items-center justify-between group">
                    <div class="text-left">
                        <div class="font-bold text-lg text-gray-800 group-hover:text-red-600 transition">å®Œå…¨è‹±ä½œæ–‡</div>
                        <div class="text-xs text-gray-500">è¨˜è¿°å•é¡Œã§å®Œç’§ã«ä»•ä¸Šã’ã‚‹</div>
                    </div>
                    <i class="fas fa-keyboard text-gray-300 group-hover:text-red-500 transition"></i>
                </button>
                
                <button onclick="startQuiz('all')" class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center transform hover:-translate-y-1">
                    <div class="font-bold text-lg"><i class="fas fa-layer-group mr-2"></i>å…¨å•ãƒ‰ãƒªãƒ«</div>
                </button>
            </div>
        </div>

        <!-- 2. Explanation Screen (Detailed) -->
        <div id="explanation-screen" class="hidden max-w-2xl mx-auto fade-in pb-20">
            <h2 class="text-2xl font-bold text-center text-indigo-700 mb-6 border-b-4 border-indigo-200 inline-block pb-1 mx-auto block">é‡è¦ãƒã‚¤ãƒ³ãƒˆå®Œå…¨æ”»ç•¥</h2>

            <!-- Unit 5 Explanation -->
            <div id="exp-unit-5" class="hidden space-y-6">
                <div class="mb-2 text-sm font-bold text-white bg-green-500 inline-block px-3 py-1 rounded-full">Unit 5</div>
                
                <!-- Point 1: Wh- Questions -->
                <div class="explanation-card" style="border-left-color: #10b981;">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">1</span> ã€Œã©ã“ï¼Ÿã€ã¨ã€Œã„ã¤ï¼Ÿã€</h3>
                    <p class="text-gray-600 mb-3 text-sm">ç–‘å•è©ï¼ˆWh-ã§å§‹ã¾ã‚‹è¨€è‘‰ï¼‰ã¯å¿…ãšæ–‡ã®å…ˆé ­ã«æ¥ã¾ã™ã€‚</p>
                    
                    <div class="space-y-4">
                        <div class="rule-box bg-white border border-gray-200 shadow-sm">
                            <p class="text-center text-xs font-bold text-indigo-400 mb-1">beå‹•è©ã®æ–‡</p>
                            <p class="font-bold text-lg text-center mb-1"><span class="text-red-500">Where</span> is the library?</p>
                            <div class="mt-1 text-center text-xs text-gray-600">â†’ It's <span class="text-blue-500">on</span> the second floor.</div>
                        </div>

                        <div class="rule-box bg-blue-50 border border-blue-200">
                            <p class="text-center text-xs font-bold text-blue-500 mb-1">ä¸€èˆ¬å‹•è©ã®æ–‡ (do / does)</p>
                            <p class="font-bold text-lg text-center mb-1"><span class="text-red-500">Where</span> do you live?</p>
                            <p class="text-center text-xs text-gray-500">ï¼ˆã©ã“ã«ä½ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿï¼‰</p>
                            <hr class="border-blue-200 my-2 opacity-50">
                            <p class="font-bold text-lg text-center mb-1"><span class="text-red-500">When</span> do you practice?</p>
                            <div class="mt-2 text-center text-sm font-bold text-gray-700 bg-white p-2 rounded mx-4 border border-blue-100 shadow-sm">
                                â†’ <span class="text-blue-500">On</span> weekends.<br>
                                <span class="text-xs text-gray-400">ï¼ˆé€±æœ«ã§ã™ï¼‰</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Point 2: Imperatives -->
                <div class="explanation-card" style="border-left-color: #f59e0b;">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">2</span> ä¸»èªã‚’æ¶ˆã›ï¼ (å‘½ä»¤æ–‡)</h3>
                    <p class="text-gray-600 mb-3 text-sm">ä¸»èª(You)ã‚’è¨€ã‚ãšã«ã€ã„ããªã‚Š<span class="highlight-marker">å‹•è©ã®åŸå½¢</span>ã‹ã‚‰å§‹ã‚ã‚‹ã¨ã€Œã€œã—ãªã•ã„ã€ã«ãªã‚Šã¾ã™ã€‚</p>
                    <ul class="space-y-3">
                        <li class="bg-yellow-50 p-2 rounded border border-yellow-200">
                            <span class="font-bold text-orange-600 block">Turn on your camera.</span>
                            <span class="text-xs text-gray-600">ï¼ˆã‚«ãƒ¡ãƒ©ã‚’ã¤ã‘ãªã•ã„ï¼‰</span>
                        </li>
                        <li class="bg-red-50 p-2 rounded border border-red-200">
                            <span class="font-bold text-red-600 block">Don't be shy.</span>
                            <span class="text-xs text-gray-600">ï¼ˆæ¥ãšã‹ã—ãŒã‚‰ãªã„ã§ï¼šç¦æ­¢ï¼‰</span>
                        </li>
                    </ul>
                </div>

                <!-- Point 3: Prepositions (NEW) -->
                <div class="explanation-card" style="border-left-color: #8b5cf6;">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-violet-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">3</span> å ´æ‰€ã‚’è¡¨ã™å‰ç½®è©</h3>
                    <p class="text-gray-600 mb-4 text-sm">ã€Œã©ã“ã«ã‚ã‚‹ï¼Ÿã€ã‚’èª¬æ˜ã™ã‚‹é‡è¦ãƒ¯ãƒ¼ãƒ‰ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã§è¦šãˆã‚ˆã†ï¼</p>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-violet-50 p-3 rounded-lg text-center border border-violet-100">
                            <div class="text-2xl mb-1">ğŸ“¥</div>
                            <p class="font-bold text-violet-700 text-lg">in</p>
                            <p class="text-xs text-gray-600">ã€œã®ä¸­ã«</p>
                            <p class="text-[10px] text-gray-400 mt-1">in the box</p>
                        </div>
                        <div class="bg-violet-50 p-3 rounded-lg text-center border border-violet-100">
                            <div class="text-2xl mb-1">ğŸ”›</div>
                            <p class="font-bold text-violet-700 text-lg">on</p>
                            <p class="text-xs text-gray-600">ã€œã®ä¸Šã«ï¼ˆãã£ã¤ã„ã¦ï¼‰</p>
                            <p class="text-[10px] text-gray-400 mt-1">on the table</p>
                        </div>
                        <div class="bg-violet-50 p-3 rounded-lg text-center border border-violet-100">
                            <div class="text-2xl mb-1">â¬‡ï¸</div>
                            <p class="font-bold text-violet-700 text-lg">under</p>
                            <p class="text-xs text-gray-600">ã€œã®ä¸‹ã«</p>
                            <p class="text-[10px] text-gray-400 mt-1">under the chair</p>
                        </div>
                        <div class="bg-violet-50 p-3 rounded-lg text-center border border-violet-100">
                            <div class="text-2xl mb-1">ğŸª‘ğŸš¶</div>
                            <p class="font-bold text-violet-700 text-lg">by</p>
                            <p class="text-xs text-gray-600">ã€œã®ãã°ã«</p>
                            <p class="text-[10px] text-gray-400 mt-1">by the door</p>
                        </div>
                    </div>
                    <div class="mt-3 bg-gray-50 p-3 rounded border border-gray-200 text-sm">
                        <p><span class="font-bold text-indigo-600">near</span> ã¯ã€Œè¿‘ãã€ã€<span class="font-bold text-indigo-600">next to</span> ã¯ã€Œéš£ã€ã ã‚ˆã€‚</p>
                    </div>
                </div>

                <!-- Point 4: Words (Unit 5) -->
                <div class="explanation-card" style="border-left-color: #6366f1;">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-indigo-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">4</span> ãƒ†ã‚¹ãƒˆã«å‡ºã‚‹å˜èªãƒ»ç†Ÿèª</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm mb-4">
                        <div class="bg-gray-100 p-2 rounded"><span class="font-bold">library</span> : å›³æ›¸å®¤</div>
                        <div class="bg-gray-100 p-2 rounded"><span class="font-bold">cafeteria</span> : é£Ÿå ‚</div>
                        <div class="bg-gray-100 p-2 rounded"><span class="font-bold">gym</span> : ä½“è‚²é¤¨</div>
                        <div class="bg-gray-100 p-2 rounded"><span class="font-bold">stairs</span> : éšæ®µ</div>
                        <div class="bg-gray-100 p-2 rounded"><span class="font-bold">nurse's office</span> : ä¿å¥å®¤</div>
                        <div class="bg-gray-100 p-2 rounded"><span class="font-bold">front gate</span> : æ­£é–€</div>
                    </div>
                    <div class="bg-indigo-50 p-3 rounded text-sm border border-indigo-200">
                        <p class="font-bold text-indigo-700 mb-2">ğŸ”‘ é‡è¦ç†Ÿèªãƒªã‚¹ãƒˆ</p>
                        <ul class="space-y-1 text-gray-700">
                            <li>â— <strong>next to ~</strong> : ã€œã®éš£ã«</li>
                            <li>â— <strong>between A and B</strong> : Aã¨Bã®é–“ã«</li>
                            <li>â— <strong>turn on / off</strong> : é›»æºã‚’å…¥ã‚Œã‚‹ / åˆ‡ã‚‹</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Unit 6 Explanation -->
            <div id="exp-unit-6" class="hidden space-y-6 mt-8">
                <div class="mb-2 text-sm font-bold text-white bg-blue-500 inline-block px-3 py-1 rounded-full">Unit 6</div>
                
                <!-- Point 1 -->
                <div class="explanation-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">1</span> é­”æ³•ã®ã€ŒSã€ (3å˜ç¾)</h3>
                    <p class="text-gray-600 mb-4 text-sm">ä¸»èªãŒã€ŒIã€ã€ŒYouã€ä»¥å¤–ã®ã€Œä¸€äººã€ã®æ™‚ã€å‹•è©ã« <strong>s</strong> ã‚’ã¤ã‘ã¾ã™ã€‚</p>
                    <div class="rule-box text-center">
                        <p class="text-lg font-bold text-gray-700">He <span class="text-red-500 text-2xl">plays</span> soccer.</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-sm mt-3 border border-gray-200">
                        <p class="font-bold text-indigo-600 mb-2 border-b border-indigo-200 pb-1">âš ï¸ å½¢ãŒå¤‰ã‚ã‚‹è¦æ³¨æ„å‹•è©</p>
                        <ul class="space-y-2 text-gray-700">
                            <li><span class="inline-block w-12 font-bold">have</span> â†’ <span class="text-red-500 font-bold text-lg">has</span> (ä¸€ç•ªå‡ºã‚‹ï¼)</li>
                            <li><span class="inline-block w-12 font-bold">go</span> â†’ <span class="text-red-500 font-bold">goes</span> (esãŒã¤ã)</li>
                            <li><span class="inline-block w-12 font-bold">study</span> â†’ <span class="text-red-500 font-bold">studies</span> (yã‚’iã«å¤‰ãˆã¦es)</li>
                            <li><span class="inline-block w-12 font-bold">watch</span> â†’ <span class="text-red-500 font-bold">watches</span> (esãŒã¤ã)</li>
                        </ul>
                    </div>
                </div>

                <!-- Point 2 -->
                <div class="explanation-card" style="border-left-color: #ec4899;">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">2</span> ã€ŒSã€æ³¥æ£’ã«æ³¨æ„ï¼</h3>
                    <p class="text-gray-600 mb-4 text-sm">ç–‘å•æ–‡(Does)ã‚„å¦å®šæ–‡(doesn't)ã‚’ä½¿ã†ã¨ã€å‹•è©ã«ã¤ã„ã¦ã„ãŸ s ã¯<span class="highlight-marker">ç›—ã¾ã‚Œã¦å…ƒã®å½¢ï¼ˆåŸå½¢ï¼‰ã«æˆ»ã‚Šã¾ã™ã€‚</span></p>
                    <div class="space-y-3">
                        <div class="rule-box">
                            <p class="font-bold text-pink-600 text-center mb-1">å¦å®šæ–‡ (ã€œã—ã¾ã›ã‚“)</p>
                            <p class="text-center text-lg font-bold">She <span class="text-red-500 text-xl">doesn't</span> <span class="border-b-2 border-black">play</span> tennis.</p>
                        </div>
                        <div class="rule-box">
                            <p class="font-bold text-pink-600 text-center mb-1">ç–‘å•æ–‡ (ã€œã—ã¾ã™ã‹ï¼Ÿ)</p>
                            <p class="text-center text-lg font-bold"><span class="text-red-500 text-xl">Does</span> she <span class="border-b-2 border-black">play</span> tennis?</p>
                        </div>
                    </div>
                </div>

                <!-- Point 3: Words (Unit 6) -->
                <div class="explanation-card" style="border-left-color: #10b981;">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center"><span class="bg-emerald-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">3</span> ãƒ†ã‚¹ãƒˆã«å‡ºã‚‹å˜èªãƒ»ç†Ÿèª</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm mb-4">
                        <div class="bg-green-50 p-2 rounded"><span class="font-bold">active</span> : æ´»å‹•çš„ãª</div>
                        <div class="bg-green-50 p-2 rounded"><span class="font-bold">quiet</span> : é™ã‹ãª</div>
                        <div class="bg-green-50 p-2 rounded"><span class="font-bold">almost</span> : ã»ã¨ã‚“ã©</div>
                        <div class="bg-green-50 p-2 rounded"><span class="font-bold">free</span> : è‡ªç”±ãª</div>
                        <div class="bg-green-50 p-2 rounded"><span class="font-bold">tired</span> : ç–²ã‚ŒãŸ</div>
                        <div class="bg-green-50 p-2 rounded"><span class="font-bold">hungry</span> : ãŠè…¹ãŒç©ºã„ãŸ</div>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded text-sm border border-yellow-200">
                        <p class="font-bold text-yellow-700 mb-2">ğŸ”‘ é‡è¦ç†Ÿèªãƒªã‚¹ãƒˆ</p>
                        <ul class="space-y-1 text-gray-700">
                            <li>â— <strong>wash the dishes</strong> : çš¿ã‚’æ´—ã†</li>
                            <li>â— <strong>take out the garbage</strong> : ã‚´ãƒŸã‚’å‡ºã™</li>
                            <li>â— <strong>set the table</strong> : é£Ÿå“ã®æº–å‚™ã‚’ã™ã‚‹</li>
                            <li>â— <strong>don't worry</strong> : å¿ƒé…ã—ãªã„ã§</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button onclick="goHome()" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-700 transition">
                    ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                </button>
            </div>
        </div>

        <!-- 3. Question List Container -->
        <div id="quiz-list-screen" class="hidden max-w-2xl mx-auto">
            <div id="questions-container" class="space-y-8"></div>
            
            <!-- Bottom Navigation -->
            <div class="mt-12 text-center pb-10 border-t border-gray-200 pt-8">
                <button onclick="goHome()" class="w-full bg-gray-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-gray-700 transition">
                    <i class="fas fa-home mr-2"></i>ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                </button>
            </div>

            <!-- Floating Scroll Top -->
            <div class="fixed bottom-6 right-6 z-30">
                <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="bg-gray-800 text-white p-4 rounded-full shadow-lg opacity-80 hover:opacity-100 transition">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ----------------------------------------------------------------
        // State & Config
        // ----------------------------------------------------------------
        let currentMode = '';
        let targetUnit = 'all'; 
        let sortState = {};
        let choiceState = {};

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ==========================================
        // Unit Selection
        // ==========================================
        function selectUnit(unit) {
            targetUnit = unit;
            document.querySelectorAll('.unit-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-unit-${unit}`).classList.add('active');
        }

        function showExplanation() {
            document.getElementById('start-screen').classList.add('hidden');
            const expScreen = document.getElementById('explanation-screen');
            expScreen.classList.remove('hidden');
            
            if (targetUnit === 'all') {
                document.getElementById('exp-unit-5').classList.remove('hidden');
                document.getElementById('exp-unit-6').classList.remove('hidden');
            } else if (targetUnit == 5) {
                document.getElementById('exp-unit-5').classList.remove('hidden');
                document.getElementById('exp-unit-6').classList.add('hidden');
            } else {
                document.getElementById('exp-unit-5').classList.add('hidden');
                document.getElementById('exp-unit-6').classList.remove('hidden');
            }
            window.scrollTo(0, 0);
        }

        // ==========================================
        // å•é¡Œãƒ‡ãƒ¼ã‚¿ (100å•åéŒ²)
        // ==========================================
        const staticQuestions = [
            // --- Unit 5 ---
            { id: 101, unit: 5, type: 'choice', category: 'vocab', q: "ã€Œä¿å¥å®¤ã€ã‚’è‹±èªã§ï¼Ÿ", options: ["nurse's office", "teacher's room", "principal's office", "student room"], correctAnswer: "nurse's office", explain: "nurse = çœ‹è­·å¸«" },
            { id: 102, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œå›³æ›¸å®¤ã€ã‚’è‹±èªã§ï¼Ÿ", options: ["library", "book store", "study room", "laboratory"], correctAnswer: "library", explain: "lib-ra-ry" },
            { id: 103, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œé£Ÿå ‚ã€ã‚«ãƒ•ã‚§ãƒ†ãƒªã‚¢ã€", options: ["cafeteria", "cafe", "restaurant", "kitchen"], correctAnswer: "cafeteria", explain: "å­¦æ ¡ã®é£Ÿå ‚ã¯ cafeteria ã¨è¨€ã„ã¾ã™ã€‚" },
            { id: 104, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œæ­£é–€ã€ã‚’è‹±èªã§ï¼Ÿ", options: ["front gate", "back gate", "main door", "entrance"], correctAnswer: "front gate", explain: "front = å‰ã®, gate = é–€" },
            { id: 105, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œéšæ®µã€ã‚’è‹±èªã§ï¼Ÿ", options: ["stairs", "stars", "steps", "store"], correctAnswer: "stairs", explain: "è¤‡æ•°å½¢ã§ä½¿ã„ã¾ã™ã€‚" },
            { id: 106, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œã€œã®éš£ã«ã€", options: ["next to", "near", "between", "under"], correctAnswer: "next to", explain: "next to the library (å›³æ›¸å®¤ã®éš£)" },
            { id: 107, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œæ¥ãšã‹ã—ãŒã‚Šã®ã€", options: ["shy", "sad", "show", "she"], correctAnswer: "shy", explain: "Don't be shy." },
            { id: 108, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œã€œã‚’ã¤ã‘ã‚‹ï¼ˆé›»æ°—ãªã©ï¼‰ã€", options: ["turn on", "turn off", "turn right", "turn left"], correctAnswer: "turn on", explain: "Turn on your camera." },
            { id: 109, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>______ is the library?", options: ["Where", "When", "Who", "What"], correctAnswer: "Where", explain: "å ´æ‰€ã‚’ãŸãšã­ã‚‹æ™‚ã¯ Where" },
            { id: 110, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>It's ______ the second floor.", options: ["on", "in", "at", "to"], correctAnswer: "on", explain: "ã€Œã€œéšã«ã€ã¯ on ã‚’ä½¿ã„ã¾ã™ã€‚" },
            { id: 111, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>It's between the gym ______ the cafeteria.", options: ["and", "or", "to", "with"], correctAnswer: "and", explain: "between A and B (Aã¨Bã®é–“)" },
            { id: 112, type: 'choice', unit: 5, category: 'grammar', q: "å‘½ä»¤æ–‡ã«ã—ãªã•ã„ã€‚<br>ã€Œã‚«ãƒ¡ãƒ©ã‚’ã¤ã‘ãªã•ã„ã€‚ã€", options: ["Turn on your camera.", "Turns on your camera.", "You turn on your camera.", "Turning on your camera."], correctAnswer: "Turn on your camera.", explain: "å‹•è©ã®åŸå½¢ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚" },
            { id: 113, type: 'choice', unit: 5, category: 'grammar', q: "å¦å®šã®å‘½ä»¤æ–‡ã«ã—ãªã•ã„ã€‚<br>ã€Œæ¥ãšã‹ã—ãŒã‚‰ãªã„ã§ã€‚ã€", options: ["Don't be shy.", "Not be shy.", "No shy.", "Don't shy."], correctAnswer: "Don't be shy.", explain: "Don't + å‹•è©ã®åŸå½¢ã€‚shyã¯å½¢å®¹è©ãªã®ã§beå‹•è©ãŒå¿…è¦ã€‚" },
            { id: 114, type: 'choice', unit: 5, category: 'grammar', q: "ã€Œã„ã¤ã€ã‚’ãŸãšã­ã‚‹è¨€è‘‰ã¯ï¼Ÿ", options: ["When", "Where", "Who", "Whose"], correctAnswer: "When", explain: "When is your birthday?" },
            { id: 115, type: 'sort', unit: 5, category: 'grammar', q: "ç†ç§‘å®¤ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", words: ["the", "Where's", "science", "lab", "?"], correctOrder: ["Where's", "the", "science", "lab", "?"], correctAnswer: "Where's the science lab?", explain: "Where is = Where's" },
            { id: 116, type: 'sort', unit: 5, category: 'grammar', q: "ãã‚Œã¯1éšã«ã‚ã‚Šã¾ã™ã€‚", words: ["first", "on", "It's", "floor", "the", "."], correctOrder: ["It's", "on", "the", "first", "floor", "."], correctAnswer: "It's on the first floor.", explain: "on the ~ floor" },
            { id: 117, type: 'sort', unit: 5, category: 'grammar', q: "ã‚ãªãŸã¯ã©ã“ã§æ˜¼é£Ÿã‚’é£Ÿã¹ã¾ã™ã‹ï¼Ÿ", words: ["do", "have", "Where", "lunch", "you", "?"], correctOrder: ["Where", "do", "you", "have", "lunch", "?"], correctAnswer: "Where do you have lunch?", explain: "Where do you...?" },
            { id: 118, type: 'sort', unit: 5, category: 'grammar', q: "å§‹ã‚ã¾ã—ã‚‡ã†ã€‚", words: ["begin", "Let's", "."], correctOrder: ["Let's", "begin", "."], correctAnswer: "Let's begin.", explain: "Let's + åŸå½¢" },
            { id: 119, type: 'text', unit: 5, category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œã‚ãªãŸã®å­¦æ ¡ã¯ã©ã“ã§ã™ã‹ï¼Ÿã€", correctAnswer: "Where is your school?", explain: "Where is ...?" },
            { id: 120, type: 'text', unit: 5, category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œã‚ãªãŸã®æ¬¡ã®è©¦åˆã¯ã„ã¤ã§ã™ã‹ï¼Ÿã€", correctAnswer: "When is your next match?", explain: "When is ...?" },
            { id: 121, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>Let's (    ) lunch.", options: ["eat", "eats", "eating", "ate"], correctAnswer: "eat", explain: "Let's + åŸå½¢" },
            { id: 122, type: 'text', unit: 5, category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œã“ã®éƒ¨å±‹ã§èµ°ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚ã€", correctAnswer: "Don't run in this room.", explain: "Don't run..." },
            { id: 123, type: 'sort', unit: 5, category: 'grammar', q: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", words: ["Where", "restroom", "the", "is", "?"], correctOrder: ["Where", "is", "the", "restroom", "?"], correctAnswer: "Where is the restroom?", explain: "Where is..." },
            { id: 124, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œç†ç§‘å®¤ã€", options: ["science lab", "math room", "art room", "music room"], correctAnswer: "science lab", explain: "science = ç†ç§‘" },
            { id: 125, type: 'text', unit: 5, category: 'grammar', q: "ã€Œé™ã‹ã«ã—ãªã•ã„ã€‚ã€", correctAnswer: "Be quiet.", explain: "Be quiet. (quietã¯å½¢å®¹è©ãªã®ã§beãŒå¿…è¦)" },
            { id: 126, type: 'sort', unit: 5, category: 'grammar', q: "ãã®ç®±ã‚’é–‹ã‘ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚", words: ["open", "box", "Don't", "the", "."], correctOrder: ["Don't", "open", "the", "box", "."], correctAnswer: "Don't open the box.", explain: "Don't open..." },
            { id: 127, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>(    ) careful.", options: ["Be", "Do", "Are", "Is"], correctAnswer: "Be", explain: "Be careful. (æ°—ã‚’ã¤ã‘ã¦)" },
            { id: 128, type: 'choice', unit: 5, category: 'vocab', q: "ã€Œã€œã®è¿‘ãã«ã€", options: ["near", "next", "under", "on"], correctAnswer: "near", explain: "near" },
            { id: 129, type: 'text', unit: 5, category: 'grammar', q: "ã€Œå›³æ›¸é¤¨ã¯å…¬åœ’ã®éš£ã«ã‚ã‚Šã¾ã™ã€‚ã€", correctAnswer: "The library is next to the park.", explain: "next to" },
            { id: 130, type: 'sort', unit: 5, category: 'grammar', q: "ã„ã¤ç·´ç¿’ã—ã¾ã™ã‹ï¼Ÿ", words: ["you", "do", "When", "practice", "?"], correctOrder: ["When", "do", "you", "practice", "?"], correctAnswer: "When do you practice?", explain: "When do you..." },
            { id: 131, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>We cook in the (    ) room.", options: ["cooking", "cook", "cooks", "science"], correctAnswer: "cooking", explain: "cooking room (èª¿ç†å®¤)" },
            { id: 132, type: 'text', unit: 5, category: 'grammar', q: "ã€Œãƒ‰ã‚¢ã‚’é–‹ã‘ã¦ã€‚ã€", correctAnswer: "Open the door.", explain: "Open..." },
            { id: 133, type: 'sort', unit: 5, category: 'grammar', q: "ã“ã“ã§é£Ÿã¹ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚", words: ["eat", "here", "Don't", "."], correctOrder: ["Don't", "eat", "here", "."], correctAnswer: "Don't eat here.", explain: "Don't eat..." },
            { id: 134, type: 'choice', unit: 5, category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>Where (    ) your bag?", options: ["is", "do", "does", "are"], correctAnswer: "is", explain: "bagã¯å˜æ•°ãªã®ã§is" },
            { id: 135, type: 'text', unit: 5, category: 'grammar', q: "ã€Œãã‚Œã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚ã€", correctAnswer: "It's under the table.", explain: "under (ã€œã®ä¸‹ã«)" },
            
            // --- Unit 6 ---
            { id: 1, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œæ´»å‹•çš„ãªã€", options: ["active", "action", "act", "quiet"], correctAnswer: "active", explain: "Tina is very active." },
            { id: 2, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œé™ã‹ãªã€", options: ["quiet", "quick", "quit", "queen"], correctAnswer: "quiet", explain: "quiet" },
            { id: 3, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œç–²ã‚Œã¦ã„ã‚‹ã€", options: ["tired", "try", "time", "tall"], correctAnswer: "tired", explain: "tired" },
            { id: 4, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œã‚ãã‚‰ã‚ã‚‹ã€", options: ["give up", "get up", "stand up", "go up"], correctAnswer: "give up", explain: "give up" },
            { id: 7, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œã»ã¨ã‚“ã©ã€", options: ["almost", "always", "also", "about"], correctAnswer: "almost", explain: "almost" },
            { id: 11, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œçš¿ã‚’æ´—ã†ã€", options: ["wash the dishes", "wash dishes", "clean dishes", "wash plate"], correctAnswer: "wash the dishes", explain: "dishes" },
            { id: 12, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œã‚´ãƒŸã‚’å‡ºã™ã€", options: ["take out the garbage", "put out the garbage", "bring garbage", "take garbage"], correctAnswer: "take out the garbage", explain: "take out" },
            { id: 14, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œå¿ƒé…ã—ãªã„ã§ã€", options: ["Don't worry.", "Not worry.", "No problem.", "Don't mind."], correctAnswer: "Don't worry.", explain: "Don't worry." },
            { id: 15, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œæœ€è¿‘ã€è¿‘é ƒã€", options: ["these days", "those days", "this days", "that days"], correctAnswer: "these days", explain: "these days" },
            { id: 16, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>Tina (    ) a lot of friends.", options: ["has", "have", "is", "having"], correctAnswer: "has", explain: "Tina (She) -> has" },
            { id: 17, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>Ken (    ) soccer every day.", options: ["plays", "play", "playing", "is play"], correctAnswer: "plays", explain: "Ken (He) -> plays" },
            { id: 18, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>My father (    ) his car.", options: ["washes", "wash", "washing", "washs"], correctAnswer: "washes", explain: "wash -> washes" },
            { id: 19, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>She (    ) English hard.", options: ["studies", "studys", "study", "studeis"], correctAnswer: "studies", explain: "y -> ies" },
            { id: 20, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>Bob (    ) to school by bike.", options: ["goes", "go", "going", "gos"], correctAnswer: "goes", explain: "go -> goes" },
            { id: 21, unit: 6, type: 'choice', category: 'grammar', q: "å¦å®šæ–‡ã«ã—ãªã•ã„ã€‚<br>She likes music.", options: ["She doesn't like music.", "She don't like music.", "She isn't like music."], correctAnswer: "She doesn't like music.", explain: "doesn't + åŸå½¢" },
            { id: 22, unit: 6, type: 'choice', category: 'grammar', q: "ç–‘å•æ–‡ã«ã—ãªã•ã„ã€‚<br>He plays tennis.", options: ["Does he play tennis?", "Do he play tennis?", "Is he play tennis?"], correctAnswer: "Does he play tennis?", explain: "Does he + åŸå½¢" },
            { id: 26, unit: 6, type: 'sort', category: 'grammar', q: "å½¼å¥³ã¯æ­Œã†ã“ã¨ãŒå¥½ãã§ã™ã€‚", words: ["likes", "She", "singing", "."], correctOrder: ["She", "likes", "singing", "."], correctAnswer: "She likes singing.", explain: "like + ing" },
            { id: 28, unit: 6, type: 'sort', category: 'grammar', q: "å½¼å¥³ã¯å­¦æ ¡ã«è¡Œãã¾ã›ã‚“ã€‚", words: ["go", "doesn't", "She", "to", "school", "."], correctOrder: ["She", "doesn't", "go", "to", "school", "."], correctAnswer: "She doesn't go to school.", explain: "doesn't go" },
            { id: 36, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼å¥³ã¯ã„ã¤ã‚‚ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã—ã¾ã™ã€‚ã€", correctAnswer: "She always studies hard.", explain: "studies hard" },
            { id: 40, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œæ¯ã¯æ¯æœã€æœé£Ÿã‚’ä½œã‚Šã¾ã™ã€‚ã€", correctAnswer: "My mother cooks breakfast every morning.", explain: "My mother cooks" },
            { id: 44, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼å¥³ã¯æ•°å­¦ãŒå¥½ãã§ã™ã‹ï¼Ÿã€", correctAnswer: "Does she like math?", explain: "Does she like...?" },
            { id: 201, unit: 6, type: 'choice', category: 'grammar', q: "æ­£ã—ã„å½¢ã‚’é¸ã¼ã†ã€‚<br>He (    ) to school.", options: ["goes", "go", "gos", "going"], correctAnswer: "goes", explain: "go -> goes" },
            { id: 202, unit: 6, type: 'choice', category: 'grammar', q: "æ­£ã—ã„å½¢ã‚’é¸ã¼ã†ã€‚<br>She (    ) TV after dinner.", options: ["watches", "watch", "watchs", "watching"], correctAnswer: "watches", explain: "ch -> watches" },
            { id: 203, unit: 6, type: 'choice', category: 'grammar', q: "æ­£ã—ã„å½¢ã‚’é¸ã¼ã†ã€‚<br>Tom (    ) math hard.", options: ["studies", "studys", "study", "studeis"], correctAnswer: "studies", explain: "y -> ies" },
            { id: 204, unit: 6, type: 'choice', category: 'grammar', q: "æ­£ã—ã„å½¢ã‚’é¸ã¼ã†ã€‚<br>My sister (    ) a cat.", options: ["has", "have", "haves", "having"], correctAnswer: "has", explain: "have -> has" },
            { id: 205, unit: 6, type: 'choice', category: 'grammar', q: "æ­£ã—ã„å½¢ã‚’é¸ã¼ã†ã€‚<br>Ken (    ) his face.", options: ["washes", "wash", "washs", "washing"], correctAnswer: "washes", explain: "sh -> washes" },
            { id: 206, unit: 6, type: 'text', category: 'grammar', q: "ã‚«ãƒƒã‚³å†…ã®å‹•è©ã‚’é©åˆ‡ãªå½¢ã«ã—ã¦æ›¸ããªã•ã„ã€‚<br>He ( teach ) English.", correctAnswer: "teaches", explain: "teaches" },
            { id: 207, unit: 6, type: 'text', category: 'grammar', q: "ã‚«ãƒƒã‚³å†…ã®å‹•è©ã‚’é©åˆ‡ãªå½¢ã«ã—ã¦æ›¸ããªã•ã„ã€‚<br>She ( cry ) a lot.", correctAnswer: "cries", explain: "cries" },
            { id: 208, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œç§ã®çˆ¶ã¯æ–°ã—ã„è»Šã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã€", correctAnswer: "My father has a new car.", explain: "has" },
            { id: 209, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼å¥³ã¯æ”¾èª²å¾Œã€ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¾ã›ã‚“ã€‚ã€", correctAnswer: "She doesn't play tennis after school.", explain: "doesn't play" },
            { id: 210, unit: 6, type: 'sort', category: 'grammar', q: "èª°ãŒè‹±èªã‚’è©±ã—ã¾ã™ã‹ï¼Ÿ", words: ["speaks", "Who", "English", "?"], correctOrder: ["Who", "speaks", "English", "?"], correctAnswer: "Who speaks English?", explain: "Who speaks" },
            { id: 211, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œè‡ªç”±ãªã€æš‡ãªã€", options: ["free", "three", "tree", "flee"], correctAnswer: "free", explain: "free" },
            { id: 212, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œè¦ªæ„›ãªã‚‹ã€œã€", options: ["Dear", "Deer", "Door", "Near"], correctAnswer: "Dear", explain: "Dear" },
            { id: 213, unit: 6, type: 'sort', category: 'grammar', q: "å½¼ã¯ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¾ã™ã‹ï¼Ÿ", words: ["play", "Does", "he", "tennis", "?"], correctOrder: ["Does", "he", "play", "tennis", "?"], correctAnswer: "Does he play tennis?", explain: "Does he play...?" },
            { id: 214, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼ã¯æ¯æ—¥èµ°ã‚Šã¾ã™ã€‚ã€", correctAnswer: "He runs every day.", explain: "He runs" },
            { id: 215, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼å¥³ã¯éŸ³æ¥½ãŒå¥½ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€", correctAnswer: "She doesn't like music.", explain: "She doesn't like" },
            { id: 216, unit: 6, type: 'choice', category: 'grammar', q: "æ­£ã—ã„æ–‡ã‚’é¸ã³ãªã•ã„ã€‚", options: ["He uses a computer.", "He use a computer.", "He using a computer.", "He is use a computer."], correctAnswer: "He uses a computer.", explain: "He uses" },
            { id: 217, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œèª°ãŒãƒ”ã‚¢ãƒã‚’å¼¾ãã¾ã™ã‹ï¼Ÿã€", correctAnswer: "Who plays the piano?", explain: "Who plays" },
            { id: 218, unit: 6, type: 'sort', category: 'grammar', q: "å½¼å¥³ã¯ã‚ã¾ã‚Šã‚ˆãçœ ã‚Œã¾ã›ã‚“ã€‚", words: ["sleep", "She", "doesn't", "well", "."], correctOrder: ["She", "doesn't", "sleep", "well", "."], correctAnswer: "She doesn't sleep well.", explain: "doesn't sleep" },
            { id: 219, type: 'choice', unit: 6, category: 'vocab', q: "ã€ŒãŠæ°—ã«å…¥ã‚Šã®ã€", options: ["favorite", "fovorite", "favorit", "faverite"], correctAnswer: "favorite", explain: "favorite" },
            { id: 220, type: 'choice', unit: 6, category: 'vocab', q: "ã€Œã€œã‚‚ã¾ãŸï¼ˆå¦å®šæ–‡ã§ï¼‰ã€", options: ["either", "too", "also", "neither"], correctAnswer: "either", explain: "not ... either" },
            { id: 221, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>My brother (    ) in Tokyo.", options: ["lives", "live", "living", "is live"], correctAnswer: "lives", explain: "lives" },
            { id: 222, unit: 6, type: 'choice', category: 'grammar', q: "ç©ºæ¬„ã«å…¥ã‚‹èªã¯ï¼Ÿ<br>What (    ) she want?", options: ["does", "do", "is", "are"], correctAnswer: "does", explain: "What does she..." },
            { id: 223, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼ã¯æ—¥æœ¬å‡ºèº«ã§ã™ã€‚ã€", correctAnswer: "He is from Japan.", explain: "He is from / He comes from" },
            { id: 224, unit: 6, type: 'sort', category: 'grammar', q: "å½¼å¥³ã¯ã¨ã¦ã‚‚ä¸Šæ‰‹ã«æ³³ãã¾ã™ã€‚", words: ["swims", "She", "well", "very", "."], correctOrder: ["She", "swims", "very", "well", "."], correctAnswer: "She swims very well.", explain: "swims" },
            { id: 225, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œç§ã®æ¯ã¯å…ˆç”Ÿã§ã™ã€‚ã€", correctAnswer: "My mother is a teacher.", explain: "My mother is" },
            { id: 226, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼å¥³ã¯å¿™ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã€", correctAnswer: "She isn't busy.", explain: "She isn't (is not) busy." },
            { id: 227, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œæœé£Ÿã€", options: ["breakfast", "lunch", "dinner", "snack"], correctAnswer: "breakfast", explain: "breakfast" },
            { id: 228, unit: 6, type: 'choice', category: 'vocab', q: "ã€Œå¤•é£Ÿã€", options: ["dinner", "lunch", "breakfast", "supper"], correctAnswer: "dinner", explain: "dinner" },
            { id: 229, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼ã¯ãŸãã•ã‚“ã®æœ¬ã‚’èª­ã¿ã¾ã™ã€‚ã€", correctAnswer: "He reads a lot of books.", explain: "He reads... a lot of..." },
            { id: 230, unit: 6, type: 'text', category: 'grammar', q: "æ—¥æœ¬æ–‡ã‚’è‹±èªã«ã—ãªã•ã„ã€‚<br>ã€Œå½¼å¥³ã¯çŠ¬ãŒå¥½ãã§ã™ã‹ï¼Ÿã€", correctAnswer: "Does she like dogs?", explain: "Does she like...?" }
        ];

        // ==========================================
        // UI & Logic
        // ==========================================
        
        function goHome() {
            document.getElementById('questions-container').innerHTML = '';
            document.getElementById('quiz-list-screen').classList.add('hidden');
            document.getElementById('explanation-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            sortState = {};
            choiceState = {};
        }

        function startQuiz(mode) {
            currentMode = mode;
            let questionsToShow = staticQuestions.filter(q => {
                const unitMatch = (targetUnit === 'all') || (q.unit == targetUnit);
                if (!unitMatch) return false;
                if (mode === 'all') return true;
                if (mode === 'sort') return q.type === 'sort';
                if (mode === 'vocab') return q.category === 'vocab' && q.type === 'choice';
                if (mode === 'grammar') return q.category === 'grammar' && q.type === 'choice';
                if (mode === 'text') return q.type === 'text';
                return false;
            });

            if(questionsToShow.length === 0) {
                alert("å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
                return;
            }

            shuffleArray(questionsToShow);
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('explanation-screen').classList.add('hidden');
            document.getElementById('quiz-list-screen').classList.remove('hidden');
            renderQuestions(questionsToShow);
        }

        function renderQuestions(questions) {
            const container = document.getElementById('questions-container');
            questions.forEach(q => {
                const card = document.createElement('div');
                card.className = "question-card bg-white rounded-2xl shadow p-5 fade-in";
                card.id = `card-${q.id}`;
                
                let unitBadge = `<span class="text-xs font-bold text-white px-2 py-1 rounded bg-indigo-400 mr-2">Unit ${q.unit}</span>`;
                let typeText = q.type === 'text' ? 'è‹±ä½œæ–‡' : (q.type === 'sort' ? 'ä¸¦ã¹æ›¿ãˆ' : 'é¸æŠ');
                
                let html = `
                    <div class="flex items-center mb-3">
                        ${unitBadge}
                        <span class="text-xs font-bold text-gray-500 border border-gray-300 px-2 py-1 rounded">${typeText}</span>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-6 leading-relaxed">${q.q}</h3>
                `;

                html += `<div id="body-${q.id}" class="mb-6">`;
                if (q.type === 'choice') {
                    html += `<div class="grid gap-3" id="choice-area-${q.id}">`;
                    const opts = shuffleArray([...q.options]);
                    opts.forEach(opt => {
                        const safeOpt = opt.replace(/'/g, "\\'");
                        html += `<button onclick="selectChoice(${q.id}, '${safeOpt}', this)" class="choice-btn w-full p-4 rounded-xl text-left font-medium text-gray-700 bg-white">${opt}</button>`;
                    });
                    html += `</div>`;
                } else if (q.type === 'sort') {
                    sortState[q.id] = { words: shuffleArray([...q.words]), selected: [] };
                    html += `<div class="bg-indigo-50 border-2 border-indigo-200 rounded-xl p-3 min-h-[60px] mb-4 flex flex-wrap gap-2 items-center" id="sort-ans-${q.id}"><span class="text-gray-400 text-sm pointer-events-none">å˜èªã‚’ã‚¿ãƒƒãƒ—</span></div><div class="flex flex-wrap gap-2 justify-center" id="sort-bank-${q.id}">${renderSortBank(q.id)}</div><div class="text-right mt-2"><button onclick="resetSort(${q.id})" class="text-xs text-gray-500 bg-gray-200 px-3 py-1 rounded hover:bg-gray-300"><i class="fas fa-undo"></i> ãƒªã‚»ãƒƒãƒˆ</button></div>`;
                } else if (q.type === 'text') {
                    html += `<input type="text" id="text-input-${q.id}" class="custom-input w-full p-4 text-lg border-2 border-gray-300 rounded-xl bg-white focus:border-indigo-500 transition" placeholder="è‹±èªã‚’å…¥åŠ›..." autocomplete="off">`;
                }
                html += `</div>`;

                html += `<button onclick="submitAnswer(${q.id})" id="btn-submit-${q.id}" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl shadow hover:bg-indigo-700 transition transform active:scale-95">å›ç­”ã™ã‚‹</button><div id="feedback-${q.id}" class="hidden mt-6 pt-6 border-t border-gray-100"></div>`;

                card.innerHTML = html;
                container.appendChild(card);
                card.dataset.json = JSON.stringify(q);
            });
        }

        // --- Logic & Helpers ---
        function checkCorrectness(user, correct) {
            if (!user) return false;
            if (user === correct) return true;
            const expand = (str) => {
                return str
                    .replace(/doesn't/g, "does not").replace(/don't/g, "do not").replace(/isn't/g, "is not").replace(/aren't/g, "are not").replace(/can't/g, "cannot").replace(/didn't/g, "did not").replace(/won't/g, "will not")
                    .replace(/I'm/g, "I am").replace(/You're/g, "You are").replace(/He's/g, "He is").replace(/She's/g, "She is")
                    .replace(/Doesn't/g, "Does not").replace(/Don't/g, "Do not").replace(/Isn't/g, "Is not").replace(/Aren't/g, "Are not").replace(/Can't/g, "Cannot");
            };
            return expand(user) === expand(correct);
        }

        function renderSortBank(id) {
            const s = sortState[id];
            return s.words.map((w, idx) => {
                const isSelected = s.selected.includes(idx);
                if (isSelected) return '';
                return `<button onclick="tapSortWord(${id}, ${idx})" class="sort-chip bg-white border-2 border-gray-300 px-3 py-2 rounded-lg font-bold text-gray-700 shadow-sm">${w}</button>`;
            }).join('');
        }

        function selectChoice(id, text, btnElem) {
            const container = document.getElementById(`choice-area-${id}`);
            Array.from(container.children).forEach(c => c.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50'));
            btnElem.classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
            choiceState[id] = text;
        }

        function tapSortWord(id, wordIndex) {
            const s = sortState[id];
            s.selected.push(wordIndex);
            updateSortUI(id);
        }

        function removeSortWord(id, selectedIdxInArray) {
            const s = sortState[id];
            s.selected.splice(selectedIdxInArray, 1);
            updateSortUI(id);
        }

        function resetSort(id) {
            sortState[id].selected = [];
            updateSortUI(id);
        }

        function updateSortUI(id) {
            const s = sortState[id];
            const ansArea = document.getElementById(`sort-ans-${id}`);
            const bankArea = document.getElementById(`sort-bank-${id}`);
            if (s.selected.length === 0) {
                ansArea.innerHTML = '<span class="text-gray-400 text-sm pointer-events-none">å˜èªã‚’ã‚¿ãƒƒãƒ—</span>';
            } else {
                ansArea.innerHTML = s.selected.map((wordIdx, idx) => {
                    const word = s.words[wordIdx];
                    return `<button onclick="removeSortWord(${id}, ${idx})" class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded font-bold hover:bg-red-100 cursor-pointer">${word}</button>`;
                }).join('');
            }
            bankArea.innerHTML = s.words.map((w, idx) => {
                if (s.selected.includes(idx)) return '';
                return `<button onclick="tapSortWord(${id}, ${idx})" class="sort-chip bg-white border-b-4 border-gray-300 px-3 py-2 rounded-lg font-bold text-gray-700 shadow-sm active:border-b-0 active:mt-1">${w}</button>`;
            }).join('');
        }

        function submitAnswer(id) {
            const card = document.getElementById(`card-${id}`);
            const q = JSON.parse(card.dataset.json);
            const feedbackArea = document.getElementById(`feedback-${id}`);
            const btn = document.getElementById(`btn-submit-${id}`);
            
            let userAns = "";
            if (q.type === 'choice') {
                userAns = choiceState[id];
                if (!userAns) { alert("é¸æŠè‚¢ã‚’é¸ã‚“ã§ãã ã•ã„"); return; }
            } else if (q.type === 'sort') {
                if (!sortState[id] || sortState[id].selected.length === 0) { alert("å˜èªã‚’é¸ã‚“ã§ãã ã•ã„"); return; }
                const rawStr = sortState[id].selected.map(idx => sortState[id].words[idx]).join(' ');
                userAns = rawStr.replace(/\s+([.,?!])/g, '$1');
            } else if (q.type === 'text') {
                userAns = document.getElementById(`text-input-${id}`).value.trim();
                if (!userAns) { alert("å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            }

            card.classList.add('answered');
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            btn.textContent = "å›ç­”æ¸ˆã¿";

            const isStrictCorrect = userAns === q.correctAnswer;
            const isLenientCorrect = checkCorrectness(userAns, q.correctAnswer);
            const isCorrect = isLenientCorrect;

            let resultHtml = `
                <div class="flex items-center gap-4 mb-4">
                    <div class="text-5xl">${isCorrect ? 'â­•' : 'âŒ'}</div>
                    <div>
                        <div class="font-bold text-xl ${isCorrect ? 'text-green-600' : 'text-red-600'}">
                            ${isCorrect ? (isStrictCorrect ? 'æ­£è§£ï¼' : 'æ­£è§£ï¼(åˆ¥è§£)') : 'ä¸æ­£è§£...'}
                        </div>
                        ${!isCorrect ? `<div class="text-sm text-gray-500 mt-1">ã‚ãªãŸã®å›ç­”: <span class="line-through">${userAns}</span></div>` : ''}
                        ${(isCorrect && !isStrictCorrect) ? `<div class="text-xs text-orange-500 mt-1">çŸ­ç¸®å½¢ãªã©ã®é•ã„ã§ã™ãŒOKã§ã™ï¼</div>` : ''}
                    </div>
                </div>
                <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400">
                    <p class="text-xs text-gray-500 font-bold mb-1 uppercase">æ­£è§£</p>
                    <p class="text-lg font-bold text-gray-800 mb-2">${q.correctAnswer}</p>
                    <p class="text-sm text-gray-600">${q.explain || ''}</p>
                </div>
            `;
            
            feedbackArea.innerHTML = resultHtml;
            feedbackArea.classList.remove('hidden');
            feedbackArea.classList.add('fade-in');
        }
    </script>
</body>
</html>